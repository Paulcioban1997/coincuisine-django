{% load i18n %}
<!-- recettes/templates/base.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% trans "Coin-Cuisine üç≤" %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="margin:0; padding:0; min-height:100vh; background:#181818;">
{% load static %}
{% if request.resolver_match.url_name == 'home' %}
    <div style="background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.2)), url('{% static 'images/mclaren.png' %}'); background-size: cover; background-position: center; min-height: 100vh; width: 100vw; border-radius: 0 0 30px 30px; box-shadow: 0 8px 32px 0 rgba(31,38,135,0.37); display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0; padding: 0;">
        <div style="background: rgba(0,0,0,0.4); padding: 60px 40px 40px 40px; border-radius: 30px; box-shadow: 0 4px 16px 0 rgba(31,38,135,0.27); display: flex; flex-direction: column; align-items: center;">
            <h1 style="font-size: 4em; color: #ff9800; font-weight: bold; letter-spacing: 2px; text-align: center;">Official McLaren Restaurant</h1>
            <p style="font-size: 3em; margin-top: 10px; text-align: center;">üçΩÔ∏è</p>
            <p style="font-size: 1.5em; margin-top: 10px; color: #eee; text-align: center;">{% trans "Bienvenue sur le site de recettes inspir√© par la passion automobile !" %}</p>
            <div style="margin-top: 40px; display: flex; gap: 30px;">
                <a href="{% url 'login' %}" class="btn btn-warning btn-lg" style="font-size: 1.3em; font-weight: bold;">{% trans "Connexion" %}</a>
                <a href="/recipes/signup/" class="btn btn-outline-light btn-lg" style="font-size: 1.3em; font-weight: bold;">{% trans "S'inscrire" %}</a>
            </div>
        </div>
        <!-- Removed burger eaters GIF section as requested -->
    </div>
{% else %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">{% trans "Coin-Cuisine üçΩÔ∏è" %}</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        {% if user.is_authenticated %}
          {% if user.username == "Paul" %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="menuDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">{% trans "Menu" %}</a>
              <ul class="dropdown-menu" aria-labelledby="menuDropdown">
                <li><a class="dropdown-item" href="{% url 'recipe_list' %}">{% trans "Liste des recettes" %}</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="btn btn-success ms-2" href="{% url 'ajouter_recette' %}" style="font-weight:bold;">{% trans "Ajouter une recette" %}</a>
            </li>
          {% else %}
            <li class="nav-item"><a class="nav-link" href="{% url 'recipe_list' %}">{% trans "Recettes" %}</a></li>
          {% endif %}
        {% endif %}
      </ul>
      <ul class="navbar-nav ms-auto">
        {% if user.is_authenticated %}
            <li class="nav-item d-flex align-items-center">
              <a href="{% url 'reservation' %}" class="btn btn-outline-info btn-sm me-2" style="font-weight:bold;">{% trans "R√©servation en ligne" %}</a>
              <form action="{% url 'set_language' %}" method="post" style="display:inline; margin-right: 10px;">
                {% csrf_token %}
                <select name="language" class="form-select form-select-sm language-select" style="width:auto; display:inline-block;" onchange="this.form.submit()">
                  <option value="fr" {% if LANGUAGE_CODE == 'fr' %}selected{% endif %}>Fran√ßais</option>
                  <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>English</option>
                  <option value="es" {% if LANGUAGE_CODE == 'es' %}selected{% endif %}>Espa√±ol</option>
                </select>
                <input type="hidden" name="next" value="{{ request.path }}">
              </form>
              <span class="nav-link disabled" tabindex="-1" aria-disabled="true">{{ user.username }} <span style="color:#ff8700; font-size:0.9em;">({{ LANGUAGE_CODE }})</span></span>
              <form method="post" action="{% url 'logout' %}" style="display:inline; margin-left: 8px;">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-warning btn-sm" style="font-weight:bold;">{% trans "Change de compte" %}</button>
              </form>
            </li>
        {% else %}
            <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">{% trans "Connexion" %}</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">{% trans "Inscription" %}</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>
{% endif %}

<div class="container" style="min-height:70vh;">
    {% block content %}
    {% endblock %}
</div>

    <!-- Contact Us Button (shows on all pages except homepage, bottom right) -->
    {% if request.resolver_match.url_name != 'home' %}
    <button id="contactUsBtn" type="button" class="btn btn-success btn-lg" style="position: fixed; bottom: 30px; right: 30px; z-index: 1050; border-radius: 50px; box-shadow: 0 4px 16px 0 rgba(31,38,135,0.27); display: flex; align-items: center; gap: 8px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-telephone-fill" viewBox="0 0 16 16">
          <path d="M3.654 1.328a.678.678 0 0 1 .252-.927l2.29-1.147c.329-.164.731-.07.936.228l1.02 1.53c.195.293.146.678-.12.927l-.547.488a.678.678 0 0 0-.168.746c.457 1.13 1.13 2.18 2.02 3.07.89.89 1.94 1.563 3.07 2.02a.678.678 0 0 0 .746-.168l.488-.547c.249-.266.634-.315.927-.12l1.53 1.02c.298.205.392.607.228.936l-1.147 2.29a.678.678 0 0 1-.927.252c-2.01-1.01-4.01-3.01-5.02-5.02z"/>
        </svg>
        {% trans "Contactez-nous" %}
    </button>
    <!-- Contact Number Popup -->
    <div id="contactPopup" style="display:none; opacity:0; transition:opacity 0.35s; position: fixed; bottom: 90px; right: 40px; z-index: 1100; background: #fff; color: #222; border-radius: 16px; box-shadow: 0 4px 16px 0 rgba(31,38,135,0.27); padding: 18px 28px; font-size: 1.3em; font-weight: bold;">
        <span style="color: #28a745; margin-right: 10px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="#28a745" class="bi bi-telephone-fill" viewBox="0 0 16 16" style="vertical-align:middle;">
              <path d="M3.654 1.328a.678.678 0 0 1 .252-.927l2.29-1.147c.329-.164.731-.07.936.228l1.02 1.53c.195.293.146.678-.12.927l-.547.488a.678.678 0 0 0-.168.746c.457 1.13 1.13 2.18 2.02 3.07.89.89 1.94 1.563 3.07 2.02a.678.678 0 0 0 .746-.168l.488-.547c.249-.266.634-.315.927-.12l1.53 1.02c.298.205.392.607.228.936l-1.147 2.29a.678.678 0 0 1-.927.252c-2.01-1.01-4.01-3.01-5.02-5.02z"/>
            </svg>
        </span>
        514-999-CALL
    </div>
    <!-- Social Media Bar -->
    <div id="socialBar" style="position: fixed; bottom: 30px; left: 30px; z-index: 1050; display: flex; flex-direction: column; gap: 12px; align-items: flex-start;">
      <a href="https://facebook.com" target="_blank" title="Facebook" style="background:#fff; border-radius:50%; padding:7px; box-shadow:0 2px 8px #0002;"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" alt="Facebook" style="width:28px; height:28px;"></a>
      <a href="https://instagram.com" target="_blank" title="Instagram" style="background:#fff; border-radius:50%; padding:7px; box-shadow:0 2px 8px #0002;"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram" style="width:28px; height:28px;"></a>
      <a href="https://snapchat.com" target="_blank" title="Snapchat" style="background:#fff; border-radius:50%; padding:7px; box-shadow:0 2px 8px #0002;"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/snapchat.svg" alt="Snapchat" style="width:28px; height:28px;"></a>
      <a href="https://tiktok.com" target="_blank" title="TikTok" style="background:#fff; border-radius:50%; padding:7px; box-shadow:0 2px 8px #0002;"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok" style="width:28px; height:28px;"></a>
      <a href="https://youtube.com" target="_blank" title="YouTube" style="background:#fff; border-radius:50%; padding:7px; box-shadow:0 2px 8px #0002;"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube" style="width:28px; height:28px;"></a>
      <a href="#" onclick="navigator.clipboard.writeText(window.location.href); return false;" title="Copy Link" style="background:#fff; border-radius:50%; padding:7px; box-shadow:0 2px 8px #0002; display:flex; align-items:center; justify-content:center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#ff8700" viewBox="0 0 16 16"><path d="M10.5 8a.5.5 0 0 1 .5.5v5A1.5 1.5 0 0 1 9.5 15h-5A1.5 1.5 0 0 1 3 13.5v-5A1.5 1.5 0 0 1 4.5 7H5V6a3 3 0 1 1 6 0v1h.5A1.5 1.5 0 0 1 13 8.5v5A1.5 1.5 0 0 1 11.5 15h-5A1.5 1.5 0 0 1 5 13.5v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5H10.5zM6 6a2 2 0 1 1 4 0v1H6V6z"/></svg>
      </a>
    </div>
    <script>
      const contactBtn = document.getElementById('contactUsBtn');
      const contactPopup = document.getElementById('contactPopup');
      let popupTimeout = null;
      if (contactBtn && contactPopup) {
        contactBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          if (contactPopup.style.display === 'none') {
            contactPopup.style.display = 'block';
            setTimeout(() => { contactPopup.style.opacity = '1'; }, 10);
            if (popupTimeout) clearTimeout(popupTimeout);
            popupTimeout = setTimeout(() => {
              contactPopup.style.opacity = '0';
              setTimeout(() => { contactPopup.style.display = 'none'; }, 350);
            }, 3500);
          } else {
            contactPopup.style.opacity = '0';
            setTimeout(() => { contactPopup.style.display = 'none'; }, 350);
          }
        });
        // Fermer le popup si on clique ailleurs
        document.addEventListener('click', function(e) {
          if (contactPopup.style.display === 'block' && !contactPopup.contains(e.target) && e.target !== contactBtn) {
            contactPopup.style.opacity = '0';
            setTimeout(() => { contactPopup.style.display = 'none'; }, 350);
          }
        });
      }
    </script>
    {% endif %}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Soumission automatique du formulaire de langue d√®s qu'une langue est s√©lectionn√©e
  document.addEventListener('DOMContentLoaded', function() {
    var selects = document.querySelectorAll('.language-select');
    selects.forEach(function(sel) {
      sel.addEventListener('change', function() {
        sel.form.submit();
      });
    });
  });
</script>
</body>
</html>
